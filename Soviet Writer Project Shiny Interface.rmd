---
title: "Soviet Writer Project Report"
author: "Wei Dai, Jing An, Hengzhi Wu"
date: "June 2, 2016"
output: html_document
runtime: shiny
---
## Background
The client wants to study the interactions and ties between the Soviet children’s writers from 1953 to 1956. The results of the study would help show how considerable liberation in children’s literature took place, and how personal efforts and interpersonal ties between writers influenced the liberation. These are important to describe the de-stalinization process in the Soviet culture.

The client is also interested in looking at the institutional configuration, as most writers in the dataset are affiliated to one of the following four institutions (Gorky Literary Institute, Leningrad Branch of “Detgiz” Publishing House, Moscow Bureau of the Children’s Section, and “Youth” Journal).

Moreover, there are four classes of writers the client cares about:

(a) People who played crucial role in institutional interactions;
(b) People who were important as cultural referees;
(c) People who were very socially active;
(d) People who were both aesthetically and ideologically influential.

Geographically, the writers are from two cities: Moscow and Leningrad; however, most of them come from Moscow.

## Objective
The primary objective of this project is to create a network visualization of the interactions and connections between the Soviet children’s writers using a graph generated by R.

Specifically, every node in the final network graph represents a writer and the lines represent connections between writers. The color and size of each node are determined by the writer's institution and amounts of connection respectively. The strength of tie is symbolized by thickness of the line.

## Methodology
### Step 1: Data Preparation (Completed by Jing An and Hengzhi Wu)
Since the raw data were initially stored in a .word file, which is relatively inconvenient for data analysis, we decided to rearrange the data and store them in a .csv file. The following data analysis is based on the data read from the new "Soviet_Writer.csv" file. Each column in the .csv file represents:

 * Node Writer
 * Target Writer
 * Connection Strength
 * Connection Length
 * Institution

### Step 2: Data Import (Completed by Wei Dai)
Afterwards, we input the file into R for further analysis. The resulting data frame in R looks like:
```{r, echo=FALSE}
require(htmlwidgets)
#setwd("/Users/JingAn/Desktop/Soviet Writer Project/Interactive Soviet Writer Project") # sets work directory
## Input Data
soviet <- read.csv("Soviet_Writer.csv", header = TRUE, stringsAsFactor = FALSE)
colnames(soviet) <- c("Node Writer", "Target Writer", "Strength", "Length", "Institution")
library(knitr)
kable(head(soviet, n = 15))

```

### Step 3: Static Diagram (Completed by Wei Dai)
We then create "nodes" and "links" objects respectively from the soviet data frame in order to plot the network diagram. The "nodes" object contains information of writer's name, institution, connection amounts (degree), and institution type (numerical representation of each institution). The "links" object contains the adjacency matrix as well as the weight and length of each connection. The resulting static diagram is displayed below:

```{r, message=FALSE, echo=FALSE, fig.height=7, fig.width=7}
## Data Preparation
colnames(soviet) <- c("from", "to", "weight", "length", "institution")
links <- soviet[, 1:4]
links <- links[order(links$from, links$to), ]
rownames(links) <- NULL
nodes <- soviet[!duplicated(soviet$to), c(2, 5)]
names(nodes)[1] <- "writer"
nodes <- nodes[order(nodes$writer), ]
rownames(nodes) <- NULL
## Create a new numerical variable institution.type for nodes object
nodes$institution.type[nodes$institution == "Leningrad Branch of \"Detgiz\" Publishing House"] <- 1
nodes$institution.type[nodes$institution == "\"Youth\" Journal"] <- 2
nodes$institution.type[nodes$institution == "Moscow Bureau of the Children's Section"] <- 3
nodes$institution.type[nodes$institution == "Gorky Literary Institute"] <- 4

## Static Graph
library(igraph)
static_net <- graph.data.frame(links, nodes, directed = FALSE)
static_net <- simplify(static_net, remove.multiple = TRUE, remove.loops = TRUE)

## Generate colors base on institution:
colors <- c("skyblue", "tomato", "gold", "green")
V(static_net)$color <- colors[V(static_net)$institution.type]

## Compute node degree (#links) and use it to set node size:
deg <- degree(static_net)
nodes$degree[intersect(names(deg), nodes$writer)] <- deg[intersect(names(deg), nodes$writer)]
V(static_net)$size <- deg*1.2


## Set edge width based on link weight:
E(static_net)$width <- E(static_net)$weight/2

## Change arrow size and edge color:
E(static_net)$arrow.size <- 0.2
E(static_net)$edge.color <- "gray80"

set.seed(10000)
plot(static_net, vertex.frame.color = "#ffffff", vertex.label.color = "black", mark.groups = list(which(nodes$institution.type == 1), which(nodes$institution.type == 2), which(nodes$institution.type == 3), which(nodes$institution.type == 4)), mark.col = c("#C5E5E7", "#EC9AAE", "#ECD89A", "#D7EC9A"), mark.border = NA)
legend(x = -1.5, y = -0.85, c("Leningrad Branch of \"Detgiz\" Publishing House", "\"Youth\" Journal", "Moscow Bureau of the Children's Section", "Gorky Literary Institute"), pch = 21, col = "#777777", pt.bg = colors, pt.cex = 2, cex = 0.8, bty = "n", ncol = 1)
```

### Step 4: Dynamic Diagram (Completed by Wei Dai)
In order to have a better interactive presentation of the network, we create a dynamic diagram, which can be easily inserted in the website. The features of this dynamic diagram include:

* Zoom In & Zoom Out: User can zoom in and zoom out the entire diagram conveniently using a mouse.
* Node Click: After clicking a specific node, the corresponding information regarding this writer, including writer's name and institution, will show up.
* Link Click: After clicking a specific link, the corresponding information regarding this connection, including the weight of the connection, will show up.

The resulting diagram is displayed below:

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(network)
library(ndtv)
network <- network(links, vertex.attr = nodes, matrix.type = "edgelist", loops = FALSE, multiple = FALSE, ignore.eval = FALSE)
## Assign node color based on institution type
network %v% "col" <- c("gray70", "tomato", "gold", "green")[network %v% "institution.type"]
## Dynamic Graph
set.seed(10000)
render.d3movie(network, usearrows = FALSE, displaylabels = TRUE, label.col = "white", bg = "#111111", vertex.border = "#ffffff", vertex.col = network %v% "col", vertex.cex = (network %v% "degree")/5, edge.lwd = (network %e% "weight"), edge.col = '#55555599', vertex.tooltip = paste("<b>Name:</b>", (network %v% 'writer'), "<br>", "<b>Institution:</b>", (network %v% 'institution'), "<br>", "<b>Degree:</b>", (network %v% 'degree')), edge.tooltip = paste("<b>Connection Weight:</b>", (network %e% "weight")), filename = "Soviet_Writer_Network.html", launchBrowser = F, output.mode = 'htmlWidget')
```

For a fully functional diagram, please see the "Soviet\_Writer\_Network.html" file.

### Step 5: Web Application (Completed by Jing An, Hengzhi Wu)
Here we used a web application framework named Shiny to embed R codes. Shiny combines the computational power of R with the interactivity of the modern web. We used a tab panel as the main structure to display the static diagram as well as the dynamic diagram simultaneously. User can choose which diagram to appear by simply clicking the tab located at the top of the window. Considering the situation that the user may want to add more connections into the dataset, we have also included an input area on the left. There are three text input boxes where user can enter new writer's name, institution and whom the writer was connected to. Also the two slider input options can inport the strength and length of the connection.

Above are the framework we have generated so far for this visualization project. In the future, after clicking the submit button, the new data entry entered will be saved to the main datasest. User only needs to reopen the application in order for RStudio to generate the updated diagrams.

```{r, echo=FALSE}

# Shiny Output
output$plot1 <- renderPlot({
  plot(static_net, vertex.frame.color = "#ffffff", vertex.label.color = "black", mark.groups = list(which(nodes$institution.type == 1), which(nodes$institution.type == 2), which(nodes$institution.type == 3), which(nodes$institution.type == 4)), mark.col = c("#C5E5E7", "#EC9AAE", "#ECD89A", "#D7EC9A"), mark.border = NA)
  legend(x = -1.5, y = -0.85, c("Leningrad Branch of \"Detgiz\" Publishing House", "\"Youth\" Journal", "Moscow Bureau of the Children's Section", "Gorky Literary Institute"), pch = 21, col = "#777777", pt.bg = colors, pt.cex = 2, cex = 0.8, bty = "n", ncol = 1)
})
output$plot2 <- ndtv:::renderNdtvAnimationWidget({ 
   render.d3movie(network, usearrows = FALSE, displaylabels = TRUE, label.col = "white", bg = "#111111", vertex.border = "#ffffff", vertex.col = network %v% "col", vertex.cex = (network %v% "degree")/5, edge.lwd = (network %e% "weight"), edge.col = '#55555599', vertex.tooltip = paste("<b>Name:</b>", (network %v% 'writer'), "<br>", "<b>Institution:</b>", (network %v% 'institution'), "<br>", "<b>Degree:</b>", (network %v% 'degree')), edge.tooltip = paste("<b>Connection Weight:</b>", (network %e% "weight")), filename = "Soviet_Writer_Network.html", launchBrowser = F, output.mode = 'htmlWidget')
})


# Shiny interface
library(shiny)
shinyUI(navbarPage(
  "Soviet Writer Project",
  tabPanel("Static Plot", 
    sidebarLayout(sidebarPanel(
      div(
        id = "form",
        textInput("Node.Writer", "Author's name", ""),
        textInput("Institution", "Institution", ""),
        textInput("Target.Writer", "Connected to whom"),
        sliderInput("Strength", "Strength of the connection", 0, 5, 1, ticks = FALSE),
        sliderInput("Length", "Length of the connection", 0, 5, 1, ticks = FALSE),
        actionButton("submit", "Submit", class = "btn-primary")
        )
      ),
      mainPanel(
        plotOutput("plot1", width = 600, height = 600)
        )
      )
    ),
  tabPanel("Dynamic Plot",
    sidebarLayout(sidebarPanel(
      div(
        id = "form",
        textInput("Node.Writer", "Author's name", ""),
        textInput("Institution", "Institution", ""),
        textInput("Target.Writer", "Connected to whom"),
        sliderInput("Strength", "Strength of the connection", 0, 5, 1, ticks = FALSE),
        sliderInput("Length", "Length of the connection", 0, 5, 1, ticks = FALSE),
        actionButton("submit", "Submit", class = "btn-primary")
        )
    ),
      mainPanel(
        ndtv::ndtvAnimationWidgetOutput("plot2")
        )
      )
    ),
  tabPanel("About", 
           mainPanel(
    h2("Project Background"),
    
p("This scheme represents interactions and ties between the Soviet children’s writers between 1953-1956.

According to my hypothesis, it would make evident how the considerable liberation in this field took

place, and how personal efforts and interpersonal ties influenced it. It is highly important when

describing the so called process of destalinization in Soviet culture. Till now this process has been

described mostly by means of generalizing concepts and even cultural myths, despite we have enough

data to attentively analyze it focusing on minor details and modes of interactions.", style = "font-family: 'times'; font-si16pt"),
p("----Екатерина Лапина", style = "font-family: 'times'; font-si16pt")


        )
    )

))


```

## R Code
```{r, eval=FALSE}
#setwd("/Users/JingAn/Desktop/Soviet Writer Project") # sets work directory
## Input Data
soviet <- read.csv("Soviet_Writer.csv", header = TRUE, stringsAsFactor = FALSE)
colnames(soviet) <- c("Node Writer", "Target Writer", "Strength", "Length", "Institution")
library(knitr)
kable(head(soviet, n = 15))

## Data Preparation
colnames(soviet) <- c("from", "to", "weight", "length", "institution")
links <- soviet[, 1:4]
links <- links[order(links$from, links$to), ]
rownames(links) <- NULL
nodes <- soviet[!duplicated(soviet$to), c(2, 5)]
names(nodes)[1] <- "writer"
nodes <- nodes[order(nodes$writer), ]
rownames(nodes) <- NULL
## Create a new numerical variable institution.type for nodes object
nodes$institution.type[nodes$institution == "Leningrad Branch of \"Detgiz\" Publishing House"] <- 1
nodes$institution.type[nodes$institution == "\"Youth\" Journal"] <- 2
nodes$institution.type[nodes$institution == "Moscow Bureau of the Children's Section"] <- 3
nodes$institution.type[nodes$institution == "Gorky Literary Institute"] <- 4

## Static Graph
library(igraph)
static_net <- graph.data.frame(links, nodes, directed = FALSE)
static_net <- simplify(static_net, remove.multiple = TRUE, remove.loops = TRUE)

## Generate colors base on institution:
colors <- c("skyblue", "tomato", "gold", "green")
V(static_net)$color <- colors[V(static_net)$institution.type]

## Compute node degree (#links) and use it to set node size:
deg <- degree(static_net, mode = "all")
nodes$degree[intersect(names(deg), nodes$writer)] <- deg[intersect(names(deg), nodes$writer)]
V(static_net)$size <- deg*1.2

## Set edge width based on link weight:
E(static_net)$width <- E(static_net)$weight/2

## Change arrow size and edge color:
E(static_net)$arrow.size <- 0.2
E(static_net)$edge.color <- "gray80"

set.seed(10000)
plot(static_net, vertex.frame.color = "#ffffff", vertex.label.color = "black", mark.groups = list(which(nodes$institution.type == 1), which(nodes$institution.type == 2), which(nodes$institution.type == 3), which(nodes$institution.type == 4)), mark.col = c("#C5E5E7", "#EC9AAE", "#ECD89A", "#D7EC9A"), mark.border = NA)
legend(x = -1.5, y = -0.85, c("Leningrad Branch of \"Detgiz\" Publishing House", "\"Youth\" Journal", "Moscow Bureau of the Children's Section", "Gorky Literary Institute"), pch = 21, col = "#777777", pt.bg = colors, pt.cex = 2, cex = 0.8, bty = "n", ncol = 1)

library(network)
library(ndtv)
network <- network(links, vertex.attr = nodes, matrix.type = "edgelist", loops = FALSE, multiple = FALSE, ignore.eval = FALSE)
## Assign node color based on institution type
network %v% "col" <- c("gray70", "tomato", "gold", "green")[network %v% "institution.type"]
## Dynamic Graph
set.seed(10000)
render.d3movie(network, usearrows = FALSE, displaylabels = TRUE, label.col = "white", bg = "#111111", vertex.border = "#ffffff", vertex.col = network %v% "col", vertex.cex = (network %v% "degree")/5, edge.lwd = (network %e% "weight"), edge.col = '#55555599', vertex.tooltip = paste("<b>Name:</b>", (network %v% 'writer'), "<br>", "<b>Institution:</b>", (network %v% 'institution'), "<br>", "<b>Degree:</b>", (network %v% 'degree')), edge.tooltip = paste("<b>Connection Weight:</b>", (network %e% "weight")), filename = "Soviet_Writer_Network.html", launchBrowser = F, output.mode = 'htmlWidget')


# Shiny Output
output$plot1 <- renderPlot({
  plot(static_net, vertex.frame.color = "#ffffff", vertex.label.color = "black", mark.groups = list(which(nodes$institution.type == 1), which(nodes$institution.type == 2), which(nodes$institution.type == 3), which(nodes$institution.type == 4)), mark.col = c("#C5E5E7", "#EC9AAE", "#ECD89A", "#D7EC9A"), mark.border = NA)
  legend(x = -1.5, y = -0.85, c("Leningrad Branch of \"Detgiz\" Publishing House", "\"Youth\" Journal", "Moscow Bureau of the Children's Section", "Gorky Literary Institute"), pch = 21, col = "#777777", pt.bg = colors, pt.cex = 2, cex = 0.8, bty = "n", ncol = 1)
})
output$plot2 <- ndtv:::renderNdtvAnimationWidget({ 
   render.d3movie(network, usearrows = FALSE, displaylabels = TRUE, label.col = "white", bg = "#111111", vertex.border = "#ffffff", vertex.col = network %v% "col", vertex.cex = (network %v% "degree")/5, edge.lwd = (network %e% "weight"), edge.col = '#55555599', vertex.tooltip = paste("<b>Name:</b>", (network %v% 'writer'), "<br>", "<b>Institution:</b>", (network %v% 'institution'), "<br>", "<b>Degree:</b>", (network %v% 'degree')), edge.tooltip = paste("<b>Connection Weight:</b>", (network %e% "weight")), filename = "Soviet_Writer_Network.html", launchBrowser = F, output.mode = 'htmlWidget')
})


# Shiny interface
library(shiny)
shinyUI(navbarPage(
  "Soviet Writer Project",
  tabPanel("Static Plot", 
    sidebarLayout(sidebarPanel(
      div(
        id = "form",
        textInput("Node.Writer", "Author's name", ""),
        textInput("Institution", "Institution", ""),
        textInput("Target.Writer", "Connected to whom"),
        sliderInput("Strength", "Strength of the connection", 0, 5, 1, ticks = FALSE),
        sliderInput("Length", "Length of the connection", 0, 5, 1, ticks = FALSE),
        actionButton("submit", "Submit", class = "btn-primary")
        )
      ),
      mainPanel(
        plotOutput("plot1", width = 600, height = 600)
        )
      )
    ),
  tabPanel("Dynamic Plot",
    sidebarLayout(sidebarPanel(
      div(
        id = "form",
        textInput("Node.Writer", "Author's name", ""),
        textInput("Institution", "Institution", ""),
        textInput("Target.Writer", "Connected to whom"),
        sliderInput("Strength", "Strength of the connection", 0, 5, 1, ticks = FALSE),
        sliderInput("Length", "Length of the connection", 0, 5, 1, ticks = FALSE),
        actionButton("submit", "Submit", class = "btn-primary")
        )
    ),
      mainPanel(
        ndtv::ndtvAnimationWidgetOutput("plot2")
        )
      )
    ),
  tabPanel("About", 
           mainPanel(
    h2("Project Background"),
    
p("This scheme represents interactions and ties between the Soviet children’s writers between 1953-1956.

According to my hypothesis, it would make evident how the considerable liberation in this field took

place, and how personal efforts and interpersonal ties influenced it. It is highly important when

describing the so called process of destalinization in Soviet culture. Till now this process has been

described mostly by means of generalizing concepts and even cultural myths, despite we have enough

data to attentively analyze it focusing on minor details and modes of interactions.", style = "font-family: 'times'; font-si16pt"),
p("----Екатерина Лапина", style = "font-family: 'times'; font-si16pt")


        )
    )

))

## detach("package:ndtv", unload = TRUE)
## detach("package:sna", unload = TRUE)
```